
<!-- AI_TASK_START: AI标题翻译 -->
[新产品/新功能] Azure 容器网络 eBPF 领域的最新更新

<!-- AI_TASK_END: AI标题翻译 -->


<!-- AI_TASK_START: AI竞争分析 -->
# 产品功能分析

## 新功能/新产品概述  
Azure Container Networking Interface (CNI) 基于 Cilium 的扩展 Berkeley Packet Filter (**eBPF**) 技术，推出了多项新功能，旨在提升 Azure Kubernetes Service (**AKS**) 集群的性能、安全性和可管理性。该产品针对容器化环境中的网络挑战，提供更高效的网络策略、观测性和路由能力。核心目标是为 **AKS** 用户群提供高可伸缩的网络解决方案，适用于大型企业级应用场景，如混合云或多云环境。市场定位聚焦于提升默认网络性能和安全，满足云计算趋势中对 **eBPF** 驱动的创新需求。

## 关键客户价值  
- **性能提升**：CiliumEndpointSlice 功能显著减少控制平面负载，导致平均 API 服务器响应延迟 _降低50%_、Pod 启动延迟 _降低60%_，以及集群内网络延迟 _降低80%_。相比传统 **CRD** 机制，此优化简化了大规模集群管理，显著提高应用性能，但可能在极高负载下增加初始配置复杂度。  
- **部署灵活性**：双栈 (**IPv4/IPv6**) 支持允许无缝处理混合网络环境，扩展 **AKS** 集群的安全策略适用性。该功能与竞品（如其他 CNI 解决方案）相比，提供更少的性能开销和复杂性，实现机制基于 eBPF 数据平面，避免了传统网络的额外转换开销。  
- **易用性改进**：Node Subnet IPAM 模式简化了小规模集群的 IP 地址分配和路由管理，结合 **Cilium** 的网络观测性，提升了整体资源利用率。与传统子网管理相比，这减少了运维负担，但在大规模环境中可能面临 IP 冲突风险。  
- **安全增强**：Cilium Layer 7 策略引入 Envoy 代理，实现基于应用层（如 HTTP 和 gRPC）的细粒度流量控制，增强合规性和防御深度。该优势在于提供比标准 Layer 4 策略更高级别的保护，但作为公共预览功能，可能存在稳定性问题，需要进一步测试。  
- **未来价值**：即将推出的 Wireguard 透明加密功能，将确保集群间流量加密，提升数据隐私合规，但潜在挑战包括加密开销对性能的影响，需要权衡在高并发场景下的适用性。

## 关键技术洞察  
- **eBPF 技术独特性**：Azure CNI 通过 **Cilium** 的 eBPF 内核扩展，实现高效的网络策略和观测，支持毫秒级事件处理。工作原理涉及在内核级别动态加载程序，减少用户态切换，从而提升数据包处理效率。该创新点显著改善了 **AKS** 的可伸缩性，但可能面临内核兼容性问题，尤其在非标准 Linux 环境中。  
- **CiliumEndpointSlice 的性能影响**：该功能批量处理端点更新，减少 **CRD** 操作的控制平面压力，实现机制基于 eBPF 的高效批处理，显著提升响应速度和资源利用率。优势在于 _降低80%_ 网络延迟，但局限性包括对集群规模的依赖，如果更新频率过高，可能增加调试难度。  
- **双栈和 IPAM 实现的挑战**：双栈支持利用 eBPF 数据平面无缝整合 **IPv4/IPv6**，创新点在于减少网络转换开销；Node Subnet 模式则简化 IP 分配，通过 eBPF 增强路由策略。对安全性和可用性的影响包括更好的流量隔离，但潜在限制是 eBPF 程序的复杂性，可能要求管理员具备高级网络知识来处理故障。  
- **Layer 7 策略的技术评估**：基于 Envoy 的应用层代理，Cilium 实现了细粒度策略（如基于 HTTP 头部的访问控制），这相对于传统 **iptables** 的创新在于更高的灵活性和可见性。但挑战包括 Envoy 的资源消耗，可能在资源受限节点上导致性能瓶颈，解决方式是通过 **ACNS** 代理优化流量路径。  
- **整体技术优势与局限**：eBPF 驱动的这些功能在性能和安全上领先竞品（如 AWS CNI），但需关注 eBPF 的内核依赖和学习曲线问题，未来可通过社区协作进一步提升稳定性。

## 其他信息  
- 即将推出的 Wireguard 加密功能将基于 **Cilium** 的开源实现，提供集群间流量加密，预计增强合规性，但需等待公共预览以评估实际影响。  
- 相关资源包括 Azure 官方文档链接，供用户深入了解配置和最佳实践。

<!-- AI_TASK_END: AI竞争分析 -->


<!-- AI_TASK_START: AI全文翻译 -->
# Azure Container Networking 中 eBPF 的最新动态！

**原始链接:** [https://techcommunity.microsoft.com/blog/azurenetworkingblog/whats-new-in-the-world-of-ebpf-from-azure-container-networking/4410254](https://techcommunity.microsoft.com/blog/azurenetworkingblog/whats-new-in-the-world-of-ebpf-from-azure-container-networking/4410254)  

**发布时间:** 2025-05-02  

**厂商:** AZURE  

**类型:** TECH-BLOG  

---  
![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDEwMjU0LWh3cHJhTg?revision=3&image-dimensions=2000x2000&constrain-image=true)  

Azure Networking Blog  

# Azure Container Networking 中 eBPF 的最新动态！  

2025 年 5 月 2 日  

## 发现 Azure CNI 基于 Cilium 的最新安全和性能改进  

Azure 容器网络接口 (CNI) 持续演进，现在借助 Cilium 的创新能力得到增强。Azure CNI Powered by Cilium (ACPC) 利用 Cilium 的扩展 Berkeley Packet Filter (eBPF) 技术，实现网络策略 (network policy) 强制执行、深度可观察性 (deep observability) 和改进的服务路由 (service routing)。以下是更深入的探讨，这些最新功能让 Azure Kubernetes 服务 (AKS) 集群的管理更高效、可扩展且安全。  

### 改进性能：Cilium Endpoint Slices  

最近更新中的亮点功能是引入 CiliumEndpointSlice。此功能显著提升了 AKS 集群中 Cilium 数据平面的性能和可扩展性。  

之前，Cilium 使用自定义资源定义 (CRDs) 称为 CiliumEndpoints 来管理 Pod。每个 Pod 都有一个关联的 CiliumEndpoint，其中包含 Pod 的状态和属性信息。然而，这种方法会给控制平面 (control plane) 带来巨大压力，尤其是在较大集群中。  

为了缓解此负载，CiliumEndpointSlice 会批量处理 CiliumEndpoints 及其更新，从而减少传播到控制平面的更新次数。我们的性能测试显示出显著改进：  

  - 平均 API 服务器响应性：延迟降低高达 50%，意味着更快处理查询。  
  - Pod 启动延迟：降低高达 60%，允许更快部署和缩放。  
  - 集群内网络延迟：降低高达 80%，转化为更好的应用性能。  

请注意，此功能在 AKS 集群中已通用可用 (Generally Available)，默认使用 Cilium 1.17 及更高版本，且无需额外配置更改！了解更多关于 CiliumEndpointSlices 通过 Azure CNI 解锁的改进 - [High-Scale Kubernetes Networking with Azure CNI Powered by Cilium | Microsoft Community Hub](<https://techcommunity.microsoft.com/blog/AzureNetworkingBlog/high-scale-kubernetes-networking-with-azure-cni-powered-by-cilium/4407234>)。  

### 部署灵活性：Cilium 网络策略的双栈支持  

在 IPv4/IPv6 双栈网络上运行的 Kubernetes 集群，使工作负载能够原生访问 IPv4 和 IPv6 端点，而不会增加额外复杂性或性能开销。之前，我们已在 AKS 1.29 及更高版本中启用双栈网络 (dual stack networking) 的预览模式，用于运行 Azure CNI Powered by Cilium 的 AKS 集群。现在，我们很高兴宣布此功能已通用可用！通过启用 IPv4 和 IPv6 寻址，您可以无缝管理生产 AKS 集群中的混合环境，适应各种网络配置。更重要的是，Azure CNI 的 Cilium 网络策略中双栈支持扩展了 AKS 集群的安全益处，例如在复杂环境中。  

例如，您可以使用 eBPF 数据平面启用双栈 AKS 集群，如以下命令所示：  

    az aks create \  
    --location <region> \  
    --resource-group <resourceGroupName> \  
    --name <clusterName> \  
    --network-plugin azure \  
    --network-plugin-mode overlay \  
    --network-dataplane cilium \  
    --ip-families ipv4,ipv6 \  
    --generate-ssh-keys  

了解更多关于 Azure CNI 的网络策略 - [Configure Azure CNI Powered by Cilium in Azure Kubernetes Service (AKS) - Azure Kubernetes Service | Microsoft Learn](<https://learn.microsoft.com/en-us/azure/aks/azure-cni-powered-by-cilium>)。  

### 易用性：Cilium 的节点子网模式  

Azure CNI 现在支持使用 Cilium 数据平面的节点子网 IPAM 模式 (Node Subnet IPAM mode)。在节点子网模式中，Pod 的 IP 地址从节点自身的子网中分配，这简化了路由和策略管理。此模式特别适用于较小集群，其中管理多个子网较为繁琐。使用此模式的 AKS 集群还获得了改进的网络可观察性、Cilium 网络策略和 FQDN 过滤等益处，以及高级容器网络服务 (ACNS) 解锁的更多功能。更值得注意的是，通过此功能，我们现在支持 AKS 集群上 eBPF 数据平面的所有 IPAM 配置选项。您可以创建使用节点子网 IPAM 模式和 eBPF 数据平面的 AKS 集群，如以下命令所示：  

    az aks create \  
    --name <clusterName> \  
    --resource-group <resourceGroupName> \  
    --location <location> \  
    --network-plugin azure \  
    --network-dataplane cilium \  
    --generate-ssh-keys  

了解更多关于节点子网 - [Configure Azure CNI Powered by Cilium in Azure Kubernetes Service (AKS) - Azure Kubernetes Service | Microsoft Learn](<https://learn.microsoft.com/en-us/azure/aks/azure-cni-powered-by-cilium#option-3-assign-ip-addresses-from-the-node-subnet-preview>)。  

### 深度防御：Cilium Layer 7 策略  

Azure CNI by Cilium 将其全面的 Layer4 网络策略能力扩展到 Layer7，提供对应用流量的细粒度控制。此功能使用户能够基于应用层协议和元数据定义安全策略，添加强大的安全和合规管理层。  

Layer7 策略使用 Envoy（一个开源服务代理）实现，Envoy 是作为 ACNS 安全代理与 Cilium 代理配合运作的一部分。Envoy 处理服务间的流量，并提供应用层必要的可见性和控制。策略可以基于 HTTP 和 gRPC 方法、路径、头部以及其他应用特定属性强制执行。此外，Cilium 网络策略支持基于 Kafka 的工作流，增强安全和流量管理。  
此功能当前处于公共预览 (public preview) 模式，您可以从这里了解更多入门体验 - [Introducing Layer 7 Network Policies with Advanced Container Networking Services for AKS Clusters! | Microsoft Community Hub](<https://techcommunity.microsoft.com/blog/azurenetworkingblog/introducing-layer-7-network-policies-with-advanced-container-networking-services/4409782>)。  

### 即将推出：Wireguard 的透明加密  

通过利用 Cilium 的 Wireguard，客户可以实现监管合规，确保所有网络流量（无论是基于 HTTP 的还是非 HTTP 的）均被加密。用户可以使用 Cilium 的开源解决方案在 Kubernetes 环境中启用节点间透明加密。当 Wireguard 启用时，每个集群节点的 Cilium 代理将与其他已知节点建立安全的 Wireguard 隧道，以加密 Cilium 端点之间的流量。此功能即将进入公共预览，并将作为 ACNS 的一部分启用。敬请期待更多细节。  

### 结语  

这些 Azure CNI Powered by Cilium 的新功能突显了我们提升 AKS 环境默认网络性能和安全的承诺，同时与开源社区合作。从 CiliumEndpointSlice 的显著性能提升，到双栈支持的适应性，以及 Layer7 策略和 Wireguard 基于加密的先进安全，这些创新确保您的 AKS 集群不仅适合当下，还为未来做好准备。此外，别忘了探索 eBPF 基于可观察性的多云环境世界！查看我们的最新帖子 - [Retina: Bridging Kubernetes Observability and eBPF Across the Clouds](<https://techcommunity.microsoft.com/blog/linuxandopensourceblog/ebpf-powered-observability-beyond-azure-a-multi-cloud-perspective-with-retina/4403361>)。  

为什么还要等？现在就来试试！  

持续关注 [AKS 公共路线图](<https://aka.ms/aks/roadmap>) 以获取更多激动人心的开发！如需更多信息，请访问：  
  * 关于 Azure CNI Powered by Cilium 的更多信息 - [Configure Azure CNI Powered by Cilium in AKS](<https://learn.microsoft.com/en-us/azure/aks/azure-cni-powered-by-cilium>)。  
  * 关于 ACNS 的更多信息 - [Advanced Container Networking Services (ACNS) for AKS | Microsoft Learn](<https://learn.microsoft.com/en-us/azure/aks/advanced-container-networking-services-overview?tabs=cilium>)。  

更新于 2025 年 5 月 2 日  

版本 2.0

<!-- AI_TASK_END: AI全文翻译 -->

