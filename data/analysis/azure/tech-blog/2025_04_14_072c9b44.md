
<!-- AI_TASK_START: AI标题翻译 -->
[新产品/新功能] Azure 子网对等功能介绍

<!-- AI_TASK_END: AI标题翻译 -->


<!-- AI_TASK_START: AI竞争分析 -->
# 产品功能分析

## 新功能/新产品概述  
Azure Subnet Peering 是针对虚拟网络 (VNET) 的新功能，允许用户仅连接特定子网地址空间，而非整个 VNET，从而 **节省 IPv4 地址空间**、限制不必要的子网暴露，并支持 **IPv6 only peering**。该功能构建于现有 **VNET Peering** 基础上，提供更精细的控制选项，适用于企业级网络架构。背景在于云计算环境中地址空间重叠和 IPv6 过渡的需求，目标用户群为使用 Azure 的中大型企业，特别是那些在 **混合云** 或 **多区域部署** 中面临网络隔离和资源优化的场景。市场定位聚焦于提升网络灵活性和效率，预计于 2025 年 3 月进入公测和正式发布，目前需通过订阅白名单申请使用。

## 关键客户价值  
- **地址空间优化**：通过仅连接特定子网，用户可 **重用 IPv4 地址空间**，减少浪费，尤其在 **重叠地址空间** 的 **Hub and Spoke 模型** 中，避免不必要的网络冲突，与传统 VNET Peering 的全连接方式相比，差异在于精细控制，实现了 _潜在成本降低 20%_ 以上，因为减少了冗余路由开销。  
- **安全性提升**：限制子网暴露，仅将必要子网连接到网关或远程 VNET，显著降低攻击面，例如在 **网关场景** 中，仅向本地网络暴露特定子网，与竞品如 AWS VPC Peering 的全网连接相比，具有优势，但需注意管理复杂性可能增加。  
- **IPv6 过渡支持**：启用 **IPv6 only peering**，允许双栈子网仅通过 IPv6 连接，促进 IPv6 采用，在高并发场景中体现为 _延迟优化和带宽效率提升_，相较于 Google Cloud 的子网连接，Azure 的实现更注重灵活性，但可能受限于当前 IPv6 生态的成熟度。  
  - 在突发流量或混合环境场景中，这些价值通过减少路由表大小和优化流量路径来体现，确保业务连续性。

## 关键技术洞察  
- **技术独特性**：基于 **Azure Virtual Network** 的扩展，引入参数如 **--peer-complete-vnet**（默认 true，表示全 VNET 连接；设为 false 时启用子网选择）和 **--enable-only-ipv6**，允许用户指定本地和远程子网（如 **--local-subnet-names** 和 **--remote-subnet-names**）。工作原理是通过 **Azure Resource Manager (ARM)** 和 CLI/API 更新 peering 配置，仅在地址空间唯一时建立连接，确保流量隔离。  
- **创新点与影响**：创新在于精细粒度控制子网连接，提升了 **网络隔离和资源利用率**，对性能影响包括 _支持高达 400 个子网参与（每侧 200 个）_，改善了可用性；安全性通过限制暴露减少风险，但对 **高并发场景** 的影响需监控路由效率。同时，技术实现了事件驱动的路由更新，提升了整体架构的动态性。  
- **挑战与解决方式**：当前限制包括子网必须 **唯一且属于唯一地址空间**，且只能有一个 peering 链接（无法直接切换类型），这可能导致管理复杂度上升；在公测阶段，存在非 peered 子网的转发路由问题（后续版本移除）。解决方式是通过订阅白名单和表单注册逐步 rollout，确保用户在配置时使用 CLI 或 ARM 工具，避免冲突；相较于传统 IaaS，该功能引入了更智能的 **软件定义网络 (SDN)** 元素，但冷启动或配置错误可能影响初始部署。

## 其他信息  
- **使用限制**：子网 peering 不支持 **Azure Virtual WAN** 或 **AVNM Connected Group** 中的某些场景，如 peering 与 VNET peering 冲突时需手动管理；公测版本（2025 年 3 月）需填写 [表单](https://forms.office.com/r/99J2fSfd9L) 注册订阅。  
- **学习资源**：参考 [Azure VNET Peering 文档](https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview) 和 [配置指南](https://learn.microsoft.com/en-us/azure/virtual-network/how-to-configure-subnet-peering)，联系点为 amitmishra@microsoft.com。

<!-- AI_TASK_END: AI竞争分析 -->


<!-- AI_TASK_START: AI全文翻译 -->
# Azure 中的子网对等 (Subnet Peering) 介绍

**原始链接:** [https://techcommunity.microsoft.com/blog/azurenetworkingblog/introducing-subnet-peering-in-azure/4383841](https://techcommunity.microsoft.com/blog/azurenetworkingblog/introducing-subnet-peering-in-azure/4383841)  

**发布时间:** 2025-04-14  

**厂商:** AZURE  

**类型:** TECH-BLOG  

---  
![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00MzgzODQxLWFKcFJVcA?revision=8&image-dimensions=2000x2000&constrain-image=true)  

Azure Networking Blog  

# Azure 中的子网对等 (Subnet Peering)  

2025 年 4 月 14 日  

## 子网对等功能允许用户在本地和远程虚拟网络 (VNETs) 之间对等特定子网，从而通过重用节省 IPv4 地址空间、限制非对等子网通过中心网关的不必要暴露，并为双栈子网实现仅 IPv6 对等。  

子网对等 (Subnet Peering) 是连接两个虚拟网络 (VNETs) 的方法，通过仅链接子网地址空间而非整个虚拟网络 (VNETs) 地址空间。它让用户指定哪些子网应参与本地和远程虚拟网络 (VNETs) 之间的对等。  

这是在虚拟网络对等 (VNET Peering) 基础上添加的灵活性，用户可以选择需要跨虚拟网络 (VNETs) 对等的特定子网。用户可以输入希望对等的子网列表。相比之下，在常规虚拟网络对等 (VNET Peering) 中，整个地址空间/子网都会对等。  

_**注意: 此功能在 TF、CLI、API、ARM、PS 中可用，且在所有区域可用。该功能正在按需基础向选定客户推出。要使用它，需要将您的订阅列入允许列表。请填写此 [表格](https://forms.office.com/r/99J2fSfd9L) 以注册您的订阅。**_  

**关键客户用例:**  

  1. **对等具有重叠地址空间的虚拟网络 (VNETs) 中的子网 (给定要对等的子网具有唯一地址并属于唯一地址空间 – 典型的中心辐射模型场景)。** 参考下面的图像:  

     ![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00MzgzODQxLTB2UFo4Rg?image-dimensions=680x259&revision=8)  

  2. **在双栈子网的情况下，仅通过 IPv6 对等子网 –** 通过子网对等 (Subnet Peering)，用户可以选择在本地和远程虚拟网络 (VNETs) 中使用 IPv6 地址空间进行对等。这使客户能够依赖 IPv6 进行对等连接。参考下面的图像:  

     ![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00MzgzODQxLVpVZG04Yg?image-dimensions=750x257&revision=8)  

  3. **与本地连接相关的网关场景**，其中管理员希望仅向本地环境暴露某些子网，而非全部。参考下面的图像:  

     ![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00MzgzODQxLWNCTkJXcg?image-dimensions=680x218&revision=8)  

#### **子网对等 (Subnet Peering) - 检查和限制**  

我们希望讨论当前版本中子网对等 (Subnet Peering) 的一些关键方面。考虑下面的子网对等 (Subnet Peering) 插图:  

![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00MzgzODQxLUVIMkFLdg?image-dimensions=618x529&revision=8)  

关键点如下:  

  1. 参与的对等子网 **_必须是唯一的_** 并 **_必须属于唯一的地址空间_**。例如，在上述图中虚拟网络 A (VNET A) 和虚拟网络 C (VNET C) 的对等 (黑色箭头线) 中，虚拟网络 A (VNET A) 无法通过子网 1、子网 2 和子网 3 与虚拟网络 C (VNET C) 中的任何子网进行子网对等 (Subnet Peering)，因为这些子网属于虚拟网络 A (VNET A) 的 10.1.0.0/16 地址空间，而虚拟网络 C (VNET C) 中也存在此地址空间。  
     然而，虚拟网络 A (VNET A) 的子网 4 (10.0.1.0/24) 仍然可以与虚拟网络 C (VNET C) 的子网 5 (10.6.1.0/24) 进行子网对等 (Subnet Peering)，因为这些子网在虚拟网络 (VNETs) 之间是唯一的，并属于唯一的地址空间。请注意，子网 4 属于虚拟网络 A (VNET A) 中的 10.0.0.0/16 地址空间，而子网 5 属于虚拟网络 C (VNET C) 中的 10.6.0.0/16 地址空间。  

  2. **任意两个虚拟网络 (VNETs) 之间只能有一个对等链接**。如果要添加或删除对等链接中的子网，则需要更新相同的对等链接。**这也意味着多个独占对等在子网集合之间不可行。**  
     _此外，给定对等链接类型无法更改。这意味着，如果虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 之间存在虚拟网络对等 (VNET Peering)，并且用户希望将其更改为子网对等 (Subnet Peering)，则需要删除现有的虚拟网络对等 (VNET Peering) 链接，并创建新的对等链接，使用所需的子网对等 (Subnet Peering) 参数，反之亦然。_  

  3. **参与对等链接的子网数量应小于或等于 400 (本地和远程各限 200)**。例如，在上述图中虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 的对等链接 (蓝色箭头线) 中，参与对等的子网总数为 4 (虚拟网络 A (VNET A) 两侧各两个)。此数字应 <= 400。  

  4. 在当前版本 (公测和 GA 于 2025 年 3 月，功能仍受订阅标志限制) 中，从非对等子网到对等子网存在前向路由 – 即，在虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 的对等场景中，即使虚拟网络 A (VNET A) 侧的子网 2 未对等，它仍然具有指向虚拟网络 B (VNET B) 中的子网 1 和子网 2 的路由。  

     为进一步澄清，在虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 的子网对等 (Subnet Peering) 中，客户可能期望虚拟网络 A (VNET A) 中的子网 1 和子网 3 仅具有指向远程虚拟网络 B (VNET B) 中的子网 1 和子网 2 的路由，然而，虚拟网络 A (VNET A) 中的子网 2 和子网 4 (未对等) 也具有指向远程侧 (虚拟网络 B (VNET B)) 子网 1 和子网 2 的路由，尽管数据包会被丢弃且无法到达虚拟机 (VM)。  

     此限制将在 GA 后版本中移除。  

  5. **子网对等 (Subnet Peering) 和 AVNM 连接组**  
     请注意，如果两个虚拟网络 (VNETs) 在“连接组”中连接，并且在这些虚拟网络 (VNETs) 上配置了子网对等 (Subnet Peering)，则子网对等 (Subnet Peering) 优先，非对等子网之间的连接将被中断。  
     _**AVNM 连接配置**_  
     AVNM 目前无法区分虚拟网络对等 (VNET Peering) 和子网对等 (Subnet Peering)。例如，如果虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 之间存在子网对等 (Subnet Peering)，并且稍后 AVNM 用户尝试通过某些连接配置 (如中心辐射部署) 在虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 之间建立虚拟网络对等 (VNET Peering)，则 AVNM 会假定虚拟网络 A (VNET A) 和虚拟网络 B (VNET B) 之间的对等已存在，并忽略新的对等请求。我们建议用户在使用 AVNM 和子网对等 (Subnet Peering) 时注意此类冲突场景。  

  6. **子网对等 (Subnet Peering) 和 Virtual WAN** : 目前 Azure Virtual WAN 不支持子网对等 (Subnet Peering)。  

**__注意:__ 该功能正在按需基础向选定客户推出。**  

要使用它，需要将您的订阅列入允许列表。请填写此 [表格](https://forms.office.com/r/99J2fSfd9L) 以注册您的订阅。  

#### **如何配置子网对等 (Subnet Peering)?**  

在现有的虚拟网络对等 (VNET Peering) 创建过程中，引入了几个新的可选参数 (参考 A 到 D)。  

下面是每个参数的描述/参考:  

**A.**  

**\--peer-complete-vnet**  

此参数让用户选择子网对等 (Subnet Peering)。默认值为 true，这意味着整个虚拟网络 (VNETs) 会对等 (所有地址空间/子网)。要启用子网对等 (Subnet Peering)，需将此参数设置为 false (0/f/n/no)。  

接受的值: 0, 1, f, false, n, no, t, true, y, yes  

**默认值: True**  

az network vnet peering create --name  

\--remote-vnet  

\--resource-group  

\--vnet-name  

[--allow-forwarded-traffic {0, 1, f, false, n, no, t, true, y, yes}]  

[--allow-gateway-transit {0, 1, f, false, n, no, t, true, y, yes}]  

[--allow-vnet-access {0, 1, f, false, n, no, t, true, y, yes}]  

[--no-wait {0, 1, f, false, n, no, t, true, y, yes}]  

[--use-remote-gateways {0, 1, f, false, n, no, t, true, y, yes}]  

**[--peer-complete-vnet {0, 1(default), f, false, n, no, t, true, y, yes}]**  

**B. --local-subnet-names**  

此参数让用户输入希望与远程子网对等的本地子网名称，如果通过将“peer-complete-vnet”参数设置为 false 启用了子网对等 (Subnet Peering)。  

**C. --remote-subnet-names**  

此参数让用户输入希望与本地子网对等的远程子网名称，如果通过将“peer-complete-vnet”参数设置为 false 启用了子网对等 (Subnet Peering)。  

**_示例 CLI 输入:_**  

az network vnet peering create -g MyResourceGroup -n MyVnet1ToMyVnet2 --vnet-name MyVnet1 --remote-vnet MyVnet2Id --allow-vnet-access --**peer-complete-vnet** 0 **\--local-subnet-names** subnet1 subnet2 **\--remote-subnet-names** subnet1 subnet2  

**_子网对等 (Subnet Peering) 和仅 IPv6 对等_**  

_除了上述内容，在双栈子网的情况下，用户还可以配置仅 IPv6 对等，其中参与的子网仅通过 IPv6 进行交互。_  

_在双栈子网的情况下，用户可以选择仅通过 IPv6 地址空间对等子网。以前，在对等前会评估整个虚拟网络 (VNETs) 地址空间，如果重叠检查通过，则整个虚拟网络 (VNETs) 地址空间都会对等，即 IPv4 和 IPv6。但在本版本中，我们在子网对等 (Subnet Peering) 基础上提供了额外灵活性，用户可以专门选择仅通过 IPv6 地址空间进行对等。_  

_注意，目前此功能建立在子网对等 (Subnet Peering) 之上，要使用它，需要在虚拟网络对等 (VNET Peering) 创建过程中将附加参数 '**enable-only-ipv6**' 设置为 true。_  

**D. --enable-only-ipv6**  

此参数让用户选择仅通过 IPv6 功能进行子网对等 (Subnet Peering)。默认值为 false，这意味着默认通过 IPv4 地址进行对等。如果设置为 true，则在双栈子网的情况下，通过 IPv6 进行对等。  

__接受的值:__ 0, 1, f, false, n, no, t, true, y, yes  

**_示例 CLI 输入:_**  

az network vnet peering create -g MyResourceGroup -n MyVnet1ToMyVnet2 --vnet-name MyVnet1 --remote-vnet MyVnet2Id --allow-vnet-access --**peer-complete-vnet** 0 **\--enable-only-ipv6 1** **\--local-subnet-names** subnet1 subnet2 **\--remote-subnet-names** subnet1 subnet2  

在这种情况下，如果提到的子网是双栈 (或未来的仅 IPv6 子网)，则对等仅通过 IPv6 地址空间进行。  

**了解更多:**  

  * [Azure 虚拟网络 - 虚拟网络对等 (VNET Peering)](https://learn.microsoft.com/en-us/azure/virtual-network/virtual-network-peering-overview)  
  * [如何配置子网对等 (Subnet Peering)](https://learn.microsoft.com/en-us/azure/virtual-network/how-to-configure-subnet-peering)  
  * 将您的订阅列入允许列表 - 填写此 [表格](https://forms.office.com/r/99J2fSfd9L) 以使用该功能。  
  * 问题和疑虑: amitmishra@microsoft.com  

更新于 2025 年 4 月 14 日  

版本 1.0

<!-- AI_TASK_END: AI全文翻译 -->

