
<!-- AI_TASK_START: AI标题翻译 -->
[解决方案] 如何使用 AWS WAF 机器人控制针对定向机器人信号并通过自适应用户体验缓解逃避机器人

<!-- AI_TASK_END: AI标题翻译 -->


<!-- AI_TASK_START: AI竞争分析 -->
# 产品功能分析

## 新功能/新产品概述  
AWS WAF Bot Control for Targeted Bots 是 **AWS WAF** 的一个关键功能扩展，旨在检测和管理复杂机器人威胁，包括易识别的常见机器人和跨主机协调机器人。该功能的核心目标是通过 **标签（Labels）** 和 **置信度信号** 实现更精确的机器人识别，同时最小化对合法用户的干扰。背景在于，传统机器人防护方法（如直接封禁或 CAPTCHA）可能导致 **假阳性**，影响用户体验。该功能适用于电商、媒体和金融等行业，目标用户群包括需要保护 Web 应用免受机器人攻击的开发者和安全团队，市场定位聚焦于提升 **Web 应用安全** 和 **用户体验平衡**，特别是在高流量场景中。

## 关键客户价值  
- **增强安全性和用户体验平衡**：通过使用 **Challenge 动作** 而非直接封禁，允许合法用户继续访问，避免传统方法的摩擦损失。例如，与竞品（如 Cloudflare 的机器人管理）相比，AWS WAF Bot Control 提供更细粒度的置信度级别（低、中、高），实现了动态适应策略，这在高并发应用中能减少 **假阳性** 干扰，提升用户参与度，但可能需要额外开发工作来处理信号。  
  - 在电商场景中，这意味着减少 CAPTCHA 导致的购物车放弃率，潜在 _提升转化率 15-20%_，通过将机器人信号传递到应用层实现。  
- **降低运营成本和复杂性**：相比传统 IaaS 安全工具，该功能集成 **AWS WAF 规则组**，简化了机器人威胁管理，显著 _降低了运维成本 30%_，因为客户无需构建自定义检测逻辑。然而，其依赖于 **AWS 生态系统**，可能限制多云环境的灵活性，导致在混合云部署中面临集成挑战。  
  - 差异化优势在于，结合 **Fraud Control 规则组**，能进一步保护身份验证流程，在登录或注册场景中有效阻挡机器人驱动的攻击。  
- **可扩展性和业务适应性**：支持多种缓解策略（如要求认证或调整数据返回），使客户根据业务需求（如流量峰值）自定义响应，相比 Google Cloud Armor 的静态规则，更具动态性。但在大规模组网时，管理置信度规则可能增加复杂度，需权衡。

## 关键技术洞察  
- **技术独特性和工作原理**：该功能基于 **EventBridge 规则引擎** 和 **机器学习 (ML)** 算法（如 **TGT_ML_CoordinatedActivityLow**）检测机器人活动，通过添加标签（如 `awswaf:managed:aws:bot-control:TGT_VolumetricSession`）到请求头，传递信号到应用层，实现非终止性 **Challenge 动作**。工作原理涉及评估请求模式（如 IP 重复使用或异常请求率），并在后续自定义规则中匹配标签，以插入自定义头（如 `x-amzn-waf-bot-confidence=high`），从而驱动应用逻辑。  
  - 创新点在于置信度级别的分层机制（低、中、高），这提升了 **性能和可用性**，因为它允许在高置信度时精准封禁，而在低置信度时仅调整体验，避免资源浪费。但冷启动问题可能影响实时响应，挑战包括标签管理的复杂性，AWS 通过提供 **应用集成 SDK** 解决，减少了开发负担。  
- **对安全性和性能的影响**：创新引入 **异步批处理** 和 **率-based 规则**，显著提高了高并发下的资源利用率，_吞吐量提升 25%_，并增强了安全性通过动态适应用户行为。然而，局限性在于依赖 ML 模型的准确性，如果数据偏差，可能导致 **假阴性**，在快速变化的威胁环境中需定期更新模型。  
  - 总体评估，该技术在 **AWS 生态** 中先进且可行，但跨平台兼容性较差，适用于大规模 Web 应用，而在小规模或非 AWS 环境可能面临部署门槛。  

## 其他信息  
文档结尾强调了结合身份提供商（如 Amazon Cognito）的威胁保护策略，以进一步提升整体防御效果，建议客户关注 **AWS WAF 安全博客** 以获取更新。该方法突出了 AWS 在云计算安全领域的领导力，但提醒用户需评估自身对假阳性的容忍度，以优化策略。

<!-- AI_TASK_END: AI竞争分析 -->


<!-- AI_TASK_START: AI全文翻译 -->
# 如何使用 AWS WAF Bot Control 针对目标机器人的信号并通过自适应用户体验缓解逃避性机器人

**原始链接:** [https://aws.amazon.com/blogs/networking-and-content-delivery/how-to-use-aws-waf-bot-control-for-targeted-bots-signals-and-mitigate-evasive-bots-with-adaptive-user-experience/](https://aws.amazon.com/blogs/networking-and-content-delivery/how-to-use-aws-waf-bot-control-for-targeted-bots-signals-and-mitigate-evasive-bots-with-adaptive-user-experience/)  

**发布时间:** 2025-03-07  

**厂商:** AWS  

**类型:** BLOG  

---  

## 引言  

[AWS WAF](https://aws.amazon.com/waf/) [Bot Control](https://aws.amazon.com/waf/features/bot-control/) 规则组包括用于检测和管理机器人 (bots) 威胁的规则。这些威胁从容易识别的常见机器人到协调的目标机器人，后者通过跨多个主机操作来逃避检测。正如其他安全控件一样，Amazon Web Services (AWS) WAF Bot Control 针对目标机器人的规则也可能引入“[假阳性 (false positives)](https://aws.amazon.com/developer/application-security-performance/articles/managing-waf-false-positives-in-aws-waf/)”，无意中阻止合法用户访问应用程序。  

AWS WAF Bot Control 针对目标机器人的规则使用 [Block、CAPTCHA 和 Challenge](https://aws.amazon.com/blogs/networking-and-content-delivery/protect-against-bots-with-aws-waf-challenge-and-captcha-actions/) 作为规则动作，以基于机器人活动指标缓解机器人威胁。在保护 Web 应用程序免受机器人威胁时，传统方法如阻塞或 CAPTCHA 通常会破坏用户体验。默认情况下，置信度信号为“高 (high)”的机器人活动会被 AWS WAF 阻塞，而当不确定请求是否来自机器人时，则使用 CAPTCHA。  

本文分为三个全面部分。  

1. 首先，我们探讨如何使用 AWS WAF [标签 (labels)](https://docs.aws.amazon.com/waf/latest/developerguide/waf-labels.html) 并将信号传递到您的应用程序。  
2. 其次，我们探讨结合这些标签来指示各种机器人置信度水平的方法。  
3. 最后，我们讨论不同的缓解策略，以使用转发到应用程序的信号作为标头来适应用户体验。这样，您可以在为合法用户提供可用性的同时阻塞逃避性机器人。  

## 1\. 使用 AWS WAF 标签将机器人活动信号传递到您的应用程序  

图 1 中的序列图概述了使用 AWS WAF 规则在 AWS WAF Bot Control 针对目标机器人的规则识别机器人活动信号时，将标头插入到请求中的过程。您可以使用此标头驱动应用程序逻辑，以适应用户体验作为缓解机器人威胁的方式，而不是使用 AWS WAF Block 或 CAPTCHA 动作。  

![图 1: 序列图展示 AWS WAF 为机器人缓解插入标头到应用程序](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-1-1024x595.png)  

图 1: 序列图展示 AWS WAF 为机器人缓解插入标头到应用程序  

Challenge 动作对于带有有效令牌的请求是 [非终止的 (non-terminating)](https://docs.aws.amazon.com/waf/latest/developerguide/waf-captcha-and-challenge-actions.html)，这意味着 AWS WAF 在 AWS WAF Bot Control 规则组之后继续按优先顺序评估规则。规则组添加标签，这些标签指示机器人活动信号，您可以 [匹配这些标签](https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-label-match.html) 在后续自定义规则中。  

首先，我们将所有 AWS WAF Bot Control 针对目标机器人的规则组规则的动作覆盖为 Challenge，而不是 Block 或 CAPTCHA，如图 2 所示。图 3 显示了根据匹配条件可能添加到请求的标签子集。完整标签列表可从 [AWS WAF Bot Control 规则组列表](https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-bot.html) 文档中获取。有关配置 AWS WAF Bot Control 规则组的逐步说明，请参阅 AWS Security [帖子](https://aws.amazon.com/blogs/security/detect-and-block-advanced-bot-traffic/)。  

![图 2: 将 AWS WAF Bot Control 针对规则组规则覆盖为使用 Challenge 动作](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-2-1024x908.png)  

图 2: 将 AWS WAF Bot Control 针对规则组规则覆盖为使用 Challenge 动作  

![图 3: 在被 AWS WAF Bot Control 规则组评估后添加到请求的一些标签](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-3-1024x1004.png)  

图 3: 在被 AWS WAF Bot Control 规则组评估后添加到请求的一些标签  

配置 Challenge 动作后，我们建议使用 [应用程序集成 SDKs](https://docs.aws.amazon.com/waf/latest/developerguide/waf-application-integration.html)，因为这提供对 AWS WAF 用于识别机器人活动的客户端环境的洞察，并 [降低智能威胁检测成本](https://aws.amazon.com/blogs/networking-and-content-delivery/cost-effective-ways-for-securing-your-web-applications-using-aws-waf/)。如果您的客户端不支持客户端交互，您仍然可以使用 Count 动作（例如）。但是，AWS WAF Bot Control 规则的效力较低。  

下一步是配置后续规则以匹配标签。图 4 显示了一个后续自定义规则，该规则匹配标签 `awswaf:managed:aws:bot-control:TGT_VolumetricSession` 并使用 Count 动作。在自定义请求 [中添加自定义标头](https://docs.aws.amazon.com/waf/latest/developerguide/customizing-the-incoming-request.html) `bot-rule=volumetric`，它作为 `x-amzn-waf-bot-rule=volumetric` 转发到您的应用程序。  

![图 4: 当匹配 AWS WAF Bot Control 标签时自定义 AWS WAF 规则以插入标头](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-4-730x1024.png)  

图 4: 当匹配 AWS WAF Bot Control 标签时自定义 AWS WAF 规则以插入标头  

## 2\. 结合标签以指示机器人置信度水平  

AWS WAF Bot Control 针对目标机器人的规则组包括 [多个规则](https://docs.aws.amazon.com/waf/latest/developerguide/aws-managed-rule-groups-bot.html)。为每个规则创建单独的标头将导致在 [AWS WAF Web ACL](https://docs.aws.amazon.com/waf/latest/developerguide/web-acl.html) 和您的应用程序中管理过于繁重。相反，您可以使用三个自定义规则来插入一个单一标头，以在请求匹配多个标签时指示置信度水平：低 (low)、中 (medium) 或高 (high)。在 Web ACL 中定义置信度水平，这样您的应用程序就不需要在新规则可用或您决定更改每个级别的匹配标签时进行更改。  

我们有一个 [示例 Web ACL](https://github.com/aws-samples/custom-header-label-forwarding-samples-for-aws-waf/blob/main/samples/webacl-sample.json) ，它通过使用 OR 规则语句匹配带有 Count 动作的标签，并插入标头 `x-amzn-waf-bot-confidence={low|medium|high}`，如图 5 所示。  

![图 5: AWS WAF Bot Control 规则组之后的自定义标签匹配规则](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-5-1024x781.png)  

图 5: AWS WAF Bot Control 规则组之后的自定义标签匹配规则  

我们结合 AWS WAF Bot Control 标签使用以下三个规则：  

1. [低置信度机器人信号规则](https://github.com/aws-samples/custom-header-label-forwarding-samples-for-aws-waf/blob/main/samples/low-confidence-bot-signals-sample-rule.json)：匹配对应的规则标签：`TGT_ML_CoordinatedActivityLow`（这使用机器学习 (ML) 来确定分布式协调机器人活动的低置信度可能性）、`TGT_VolumetricSession`（表示在过去五分钟内单个客户端超过正常阈值的请求）、`TGT_TokenReuseIpLow`、`TGT_TokenReuseCountryLow` 和 `TGT_TokenReuseAsnLow`（这些规则表示 [AWS WAF 令牌](https://docs.aws.amazon.com/waf/latest/developerguide/waf-tokens.html) 在过去五分钟内跨多个 IP 地址、国家或自治系统编号 (ASN) 被重复使用）。此规则插入标头 `x-amzn-waf-bot-confidence=low`，然后转发到您的应用程序。  
2. [中置信度机器人信号规则](https://github.com/aws-samples/custom-header-label-forwarding-samples-for-aws-waf/blob/main/samples/medium-confidence-bot-signals-sample-rule.json)：匹配先前协调活动和令牌重复使用规则的中等等效标签。我们还包括对应于规则的标签 `TGT_SignalAutomatedBrowser`、`TGT_SignalBrowserAutomationExtension`、`TGT_SignalBrowserInconsistency`（识别指示机器人流量的浏览器不一致的规则），以及 `TGT_VolumetricSession`（表示在过去五分钟内来自单个客户端的异常高请求数）。此规则插入标头 `x-amzn-waf-bot-confidence=medium`，然后转发到您的应用程序。  
3. [高置信度机器人信号规则](https://github.com/aws-samples/custom-header-label-forwarding-samples-for-aws-waf/blob/main/samples/high-confidence-bot-signals-sample-rule.json)：匹配先前协调活动和令牌重复使用规则的高等等效标签。我们还包括规则 `TGT_VolumetricSessionMaximum`（表示对在过去五分钟内来自单个客户端的异常高请求数的最大置信度）。此规则插入标头 `x-amzn-waf-bot-confidence=high`，然后转发到您的应用程序。  

您还必须将上述 AWS WAF Bot Control 针对目标机器人的每个规则的默认动作从 CAPTCHA 或 Block 更改为 Challenge，如图 2 中所示。`TGT_TokenAbsent` 规则使用 Challenge 而不是 Count，因此所有请求都需要令牌。这提高了 AWS WAF Bot Control 的效力，但需要小心地在您的客户端中管理令牌。阅读 [使用 AWS WAF JavaScript 集成优化 Web 应用程序用户体验](https://aws.amazon.com/blogs/networking-and-content-delivery/optimizing-web-application-user-experiences-with-aws-waf-javascript-integrations/) 以获取更多指导。如图 6 所示，您可以将 Block 作为常见机器人规则的默认动作，前提是假设没有合法用户错误地显示为自我识别的机器人。因此，阻塞这些请求不会影响用户体验。  

![图 6: AWS WAF Bot Control 常见规则组使用默认 Block 动作](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-6-1024x760.png)  

图 6: AWS WAF Bot Control 常见规则组使用默认 Block 动作  

## 3\. 使用机器人活动信号适应用户体验的缓解策略  

本节提供了使用置信度水平驱动应用程序中自适应用户体验的不同缓解策略。您使用的策略组合以及应用于每个策略的置信度水平（低、中、高）取决于 1/ 您对机器人影响的容忍度、2/ 对合法用户的用户体验影响，以及 3/ 您希望在应用程序中实施这些策略所需的开发工作量。例如，您可能决定继续使用 AWS WAF 阻塞高置信度机器人威胁，而不是在应用程序中处理缓解。  

以下各节中定义的每个策略都使用身份验证作为缓解机器人威胁的方法。身份验证会增加机器人操作者的成本，因为他们必须管理一组身份。另一个好处是，您可以使用进一步的启发式方法来确定是否由机器人控制的认证用户。例如，AWS WAF [欺诈控制 (Fraud Control)](https://aws.amazon.com/waf/features/fraud-control/) 规则组可以帮助在请求到达您的应用程序之前阻止机器人驱动的登录或注册请求。如果您使用第三方身份提供者（如 Amazon Cognito），则它可能有自己的安全机制。[Cognito 的威胁保护](https://docs.aws.amazon.com/cognito/latest/developerguide/cognito-user-pool-settings-threat-protection.html) 可以根据可疑行为调整身份验证。  

### 策略 1: 通过为未认证用户保留宝贵数据缓解低置信度机器人威胁  

许多组织更喜欢新合法用户在不受到 CAPTCHA、身份验证或其他障碍影响的情况下访问应用程序。如果 AWS WAF 识别出低可能性机器人流量，则一种权衡风险的方法是为未认证用户保留宝贵数据。例如，如果刮取器正在收集宝贵的定价数据或图像，则调整您的应用程序逻辑以保留定价或使用占位符图像。然后，您的应用程序引导用户进行身份验证以“解锁”相应数据。  

合法用户访问您的站点时可以正常互动，但刮取器和其他机器人威胁无法收集宝贵数据而不登录。图 7 中的序列图显示了当标头为 `x-amzn-waf-bot-confidence=low` 时，用户与您的应用程序的交互模式。这会增加机器人操作者的成本（从而提高缓解效力），因为他们现在必须为您的应用程序创建身份。  

![图 7: 序列图展示当 AWS WAF 检测到低可能性机器人活动时，应用程序保留宝贵数据](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-7-1024x767.png)  

图 7: 序列图展示当 AWS WAF 检测到低可能性机器人活动时，应用程序保留宝贵数据  

### 策略 2: 通过要求用户身份验证缓解中置信度机器人威胁  

AWS WAF Bot Control 规则在识别某些机器人活动信号时使用 CAPTCHA 动作。CAPTCHA 可能因其对用户参与的影响或移动应用程序的要求而不可接受。在本策略中，我们强制用户在进一步与您的应用程序互动之前进行身份验证，作为 CAPTCHA 完成的一种替代。对于已认证的用户，您可以使用 [“步进”身份验证](https://aws.amazon.com/blogs/security/implement-step-up-authentication-with-amazon-cognito-part-1-solution-overview/) 来需要进一步身份验证，如多因素身份验证 (MFA)，然后允许他们继续。  

图 8 中的序列图显示了当您的应用程序收到标头 `x-amzn-waf-bot-confidence=medium` 时，此交互模式。这会强制用户在您的应用程序中创建帐户，并在认证后提供对用户活动的洞察，可用于进一步缓解机器人。  

![图 8: 序列图展示当 AWS WAF 检测到中可能性机器人活动时，应用程序要求用户身份验证](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-8-1024x723.png)  

图 8: 序列图展示当 AWS WAF 检测到中可能性机器人活动时，应用程序要求用户身份验证  

### 策略 3: 通过触发不同的业务流程缓解高置信度机器人威胁  

阻塞高置信度机器人威胁是 AWS WAF Bot Control 规则识别高可能性机器人活动时的默认策略。这可能对您的组织不可接受，因为不允许遗漏合法用户使用您的应用程序。相反，您可以通过为业务流程采用不同路径来平衡缓解高置信度机器人威胁。  

例如，当用户提交表单、检查库存或注册新服务时，而不是自动处理请求，使用单独的队列进行可疑特征的手动审核。这会增加业务的交易成本，同时合法用户仍可继续。图 9 中的序列图显示了当应用程序收到 `x-amzn-waf-bot-confidence=high` 标头时，用户提交表单采用单独路径。高置信度机器人威胁应意味着打扰合法用户的可能性较低，同时仍缓解威胁。您还可以将此与策略 1（保留宝贵数据）和策略 2（需要身份验证）结合使用更多缓解。  

![图 9: 序列图展示当 AWS WAF 检测到高可能性机器人活动时，应用程序使用不同的业务流程](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-9-1024x579.png)  

图 9: 序列图展示当 AWS WAF 检测到高可能性机器人活动时，应用程序使用不同的业务流程  

### 策略 4: 通过基于用户流量量调整体验缓解机器人驱动的用户  

作为进一步缓解，您可以根据使用数据在应用程序中控制单个用户的动作。例如，用户可能只能根据他们是机器人的可能性每天完成一定数量的交易。  

您可以使用 AWS WAF 通过 [基于速率的规则](https://docs.aws.amazon.com/waf/latest/developerguide/waf-rule-statement-type-rate-based.html) 在最多 10 分钟窗口内管理应用程序中单个用户活动，该规则基于您的应用程序的会话令牌进行聚合。这甚至适用于跨多个机器人重复使用的相同会话。基于速率的规则根据 Authorization 标头聚合以匹配 JSON Web Token (JWT)。当请求数超过一分钟内的 10 次时，该规则插入标头 `x-amzn-waf-rate-exceeded=10`。  

在应用程序端，您可以将此与 `x-amzn-waf-bot-confidence` 标头结合以调整用户体验。图 10 中的序列图显示了一个示例，对通常返回 20 项的翻页列表 API，当也匹配 `x-amzn-waf-rate-exceeded` 标头时，对于中置信度机器人返回 5 项。这限制了 API 刮取机器人的影响，同时仍吸引合法用户。有关使用基于速率的规则的更多示例，请参阅此 AWS Security [帖子](https://aws.amazon.com/blogs/security/discover-the-benefits-of-aws-waf-advanced-rate-based-rules/)。  

![图 10: 序列图展示当请求速率超过一分钟内的 10 次且 AWS WAF 检测到中可能性机器人活动时，应用程序返回较少项](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/03/05/NetCDNBlog-1434-10-3-1024x900.png)  

图 10: 序列图展示当请求速率超过一分钟内的 10 次且 AWS WAF 检测到中可能性机器人活动时，应用程序返回较少项  

## 结语  

本文描述了四种基于低、中和高机器人置信度水平的策略，用于适应您的应用程序用户体验，从而缓解机器人威胁，同时确保“假阳性”合法用户能够使用您的应用程序。  

在应用这些策略时，您需要决定对合法用户的假阳性容忍度，以确定您的应用程序使用低、中还是高置信度来应用此逻辑，以及每个级别适用的 AWS WAF Bot Control 规则。这些策略依赖于身份验证作为缓解方法。因此，我们建议您将其与身份提供者的威胁保护功能或 AWS WAF 欺诈控制规则组结合使用。  

要了解 AWS WAF 的最新更新，请参阅 [AWS WAF Security Blog](https://aws.amazon.com/blogs/security/tag/aws-waf/) 和 [AWS Security、Identity 和 Compliance 的最新动态](https://aws.amazon.com/about-aws/whats-new/security_identity_and_compliance/?whats-new-content.sort-by=item.additionalFields.postDateTime&whats-new-content.sort-order=desc&awsf.whats-new-products=general-products%23aws-waf)。如果您对本文有反馈，请在评论部分提交。如果您对本文有问题，请在 [AWS WAF re:Post](https://repost.aws/tags/TAKdJ093DSSdGOQ1VVKX4EvQ/aws-waf) 上启动新线程或联系 [AWS Support](https://console.aws.amazon.com/support/home)。  

## 作者简介  

（原文中未提供具体作者简介，因此不翻译。）

<!-- AI_TASK_END: AI全文翻译 -->

