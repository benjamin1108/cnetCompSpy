
<!-- AI_TASK_START: AI标题翻译 -->
[新产品/新功能] 通过 AWS Verified Access 与 Microsoft Entra ID 集成增强安全

<!-- AI_TASK_END: AI标题翻译 -->


<!-- AI_TASK_START: AI竞争分析 -->
# 产品功能分析

## 新功能/新产品概述  
AWS Verified Access 的新增强功能允许直接从 ID token 中提取 claims，实现与 Microsoft Entra ID 等身份提供者的无缝集成。该功能的核心在于扩展 **OpenID Connect** 协议，支持在授权流程中检查 ID token 中的用户属性（如组成员信息），以实现更精细的访问控制。**AWS Verified Access** 旨在解决传统 VPN 方案的局限性，提供基于用户身份、设备状态和应用策略的多维度评估，适用于企业级远程访问场景。背景在于云计算安全趋势的演进，目标用户群为中大型企业 IT 管理员和安全团队，市场定位聚焦于提升混合云环境的访问灵活性和安全性。

## 关键客户价值  
- **提升访问控制精细度**：通过直接使用 ID token claims（如用户组信息），组织可以实现基于 **groups** 属性的动态访问策略，例如允许 **eng-group** 成员访问开发资源，相比传统 IaaS 方案减少了手动配置，提高了操作效率，但可能增加初始策略设计的学习曲线。  
- **增强安全性和合规性**：该功能支持多因素评估（如用户身份和设备状态），显著降低了未授权访问风险，在 _高敏感数据环境_ 中体现出优势；与 Microsoft Entra ID 集成后，实现了跨平台互操作性，但需注意依赖外部身份提供者的潜在单点故障问题。  
- **简化运维和管理**：减少了对 Userinfo endpoint 的调用，优化了授权流程的性能，量化收益包括 _响应时间缩短_ 和运维成本降低；相较于竞品如 Azure AD 的类似功能，AWS 方案在 **Cedar** 政策语言上提供更灵活的自定义选项，但在大规模部署中可能面临政策冲突管理的挑战。

## 关键技术洞察  
- **技术独特性与工作原理**：基于 **OpenID Connect** 授权码流程，AWS Verified Access 新增了对 ID token 中 claims 的直接解析，例如从 Microsoft Entra ID 发出的 **groups** 键值对。通过 **Cedar** 政策语言，系统在授权上下文中提取 claims（如 `context.my_policy_reference.additional_user_context.groups`），并执行条件检查，实现事件驱动的访问决策。该机制利用 JSON Web Tokens (JWT) 标准，确保数据完整性和加密传输。  
- **技术创新点及其影响**：创新在于支持 ID token 和 Userinfo endpoint 的双重兼容，提升了 **身份提供者** 的互操作性，对性能影响显著，包括 _毫秒级响应_ 和资源利用率优化；在安全性上，强化了基于属性的访问控制 (ABAC)，提高了可用性，但可能引入冷启动延迟问题。挑战包括 claims 格式不统一的风险，AWS 通过标准化政策引用（如 **my_policy_reference**）解决，但在大规模组网中，政策评估复杂度可能上升，建议结合 **CloudWatch** 监控动态调整。  
- **实现挑战与解决方式**：处理自定义 claims 时，可能面临身份提供者兼容性问题，AWS 通过可选 claims 配置（如 Entra ID 的组成员扩展）予以缓解；相较于传统方案，该功能降低了运维门槛，但需关注加密密钥管理和审计日志的完整性，以防范潜在的安全漏洞。

<!-- AI_TASK_END: AI竞争分析 -->


<!-- AI_TASK_START: AI全文翻译 -->
# 提升安全性：使用 AWS Verified Access 和 Microsoft Entra ID 集成

**原始链接:** [https://aws.amazon.com/blogs/networking-and-content-delivery/enhancing-security-with-aws-verified-access-and-microsoft-entra-id-integration/](https://aws.amazon.com/blogs/networking-and-content-delivery/enhancing-security-with-aws-verified-access-and-microsoft-entra-id-integration/)

**发布时间:** 2025-02-25

**厂商:** AWS

**类型:** 博客

---
## 引言

与传统的 VPN 基础方法不同，[AWS Verified Access](https://aws.amazon.com/verified-access/) 会评估多个访问维度，包括用户身份、设备状态和特定应用策略。这意味着组织可以确保只有完全认证和授权的用户才能访问敏感资源，而不管其物理网络位置如何。结果是一种更灵活、更安全且更易管理的企业访问控制方法。

随着这一最新增强，AWS Verified Access 现在允许组织直接在 ID 令牌 (ID token) 中使用声明 (claims)，除了从身份提供者的 Userinfo 端点 (Userinfo endpoint) 检索声明之外。有些身份提供者如 Microsoft Entra ID (Microsoft Entra ID) 会直接在 ID 令牌中发出用户声明，而其他提供者则从 Userinfo 端点发出。AWS Verified Access 现在支持这两种方法。请参考 图 1: 了解 [OpenID Connect](https://openid.net/developers/how-connect-works/) 流程，以及 ID 令牌和 Userinfo 端点在流程中的位置。

![Illustration of the OpenID Connect authorizatoin code flow used by AWS Verified Access.](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2025/02/22/openid_connect_flow.drawio.png)

图 1: OpenID Connect 授权代码流程（点击图片在新标签页中打开更大版本）

## 理解 ID 令牌声明

ID 令牌是 OpenID Connect 的核心组件，通常由身份提供者在 OpenID Connect 认证流程中发出。这些令牌可以包含关于认证用户的丰富元数据，包括超出标准配置文件信息的自定义声明。

代码片段 1 显示了一个由 Microsoft Entra ID 发出的 ID 令牌。该令牌使用 **openid** 范围请求，并[自定义以包含用户的组成员](https://learn.microsoft.com/en-us/entra/identity-platform/optional-claims?tabs=appui#configure-groups-optional-claims)。在 ID 令牌中，**groups** 键包含用户的组列表。对象如组和用户通常使用全局唯一标识符引用，以防止意外访问。
    
    
    {
       "aud": "79f1b917-ee9b-420b-87e1-3e92b06e4aef",
       "iss": "https://login.microsoftonline.com/b58516...",
       "iat": 1737664278,
       "nbf": 1737664278,
       "exp": 1737668178,
       "aio": "AWQAm/8ZAAAAIB2lmM5JT1AzZ6DDeq...",
       "cc": "CgEAEhdhdmFibG9nLm9ubWljcm9zb2Z0L...",
       "**groups** ": [
          "**221157e3-07c3-4eb0-b62f-bae3b0c3a19b** "
       ],
       "nonce": "g4dsg5y4afi",
       "rh": "1.AWEBDhaFtXtFXEiiOMvStzAJJhe5...",
       "sub": "lUtmuMnHja-sWBffM-eFr17Ef4d4hvZQyldaGM1lHZU",
       "tid": "b585160e-457b-485c-a238-cbd2b7300926",
       "uti": "U8bFnkweQUauh5s-D6EVAA",
       "ver": "2.0"
    }
    

*代码片段 1: 由 Microsoft Entra ID 发出的示例 ID 令牌，包括用户的组成员*

## 基于组的访问控制

这一新功能的首要用例是基于 ID 令牌中的 **groups** 声明实现访问控制。许多组织通过身份提供者中的组成员管理用户访问。借助 AWS Verified Access 的新增强功能，您现在可以：

- 直接在 ID 令牌中发出用户的组成员。
- 根据用户组成员控制对 AWS Verified Access 端点的访问。

考虑一个典型的企业设置。**eng-group** 中的工程团队成员可以访问开发资源。**fin-group** 中的财务团队成员可以访问财务应用。不同的 AWS Verified Access 端点可以根据这些组配置以允许访问。

## 使用 ID 令牌声明进行策略评估

AWS Verified Access 使用一种强大的策略语言 [Cedar](https://www.cedarpolicy.com/)，允许管理员基于授权上下文创建细粒度的访问控制。下面是一个实际应用的示例。

当用户尝试访问受保护资源时，AWS Verified Access 会评估一个授权上下文，其中包括从 Userinfo 端点和 ID 令牌中获取的用户详细信息。

在创建身份信任提供者时，您提供一个策略引用名称来引用从该信任提供者接收的声明。对于我们的示例，我们使用 **my_policy_reference**。

- 通过 Userinfo 端点发出的声明直接存储在 **my_policy_reference** 中。
- 通过 ID 令牌发出的声明存储在一个嵌套键中，称为 **additional_user_context**。

两者在代码片段 2 中作为示例显示。
    
    
    {
       "**my_policy_reference** ": {
         "**additional_user_context** ": {
           "aio": "AWQAm/8ZAAAAIB2lmM5JT1AzZ6DDeq...",
           "aud": "79f1b917-ee9b-420b-87e1-3e92b06e4aef",
           "exp": 1737593337,
           "groups": [
             "221157e3-07c3-4eb0-b62f-bae3b0c3a19b"
           ],
           "iat": 1737589437,
           "iss": "https://login.microsoftonline.com/b5851...",
           "nbf": 1737589437,
           "rh": "1.AWEBDhaFtXtFXEiiOMvStzAJJhe5...",
           "sub": "lUtmuMnHja-sWBffM-eFr17Ef4d4hvZQyldaGM1lHZU",
           "tid": "b585160e-457b-485c-a238-cbd2b7300926",
           "uti": "Ui4NdOgNWU6XTX_UsU8IAA",
           "ver": "2.0"
         },
         "family_name": "Kitts",
         "given_name": "Ken",
         "name": "Ken Kitts",
         "picture": "https://graph.microsoft.com/v1.0/me/photo/xxx",
         "sub": "lUtmuMnHja-sWBffM-eFr17Ef4d4hvZQyldaGM1lHZU"
       }
     }

*代码片段 2: 包括 ID 令牌的示例授权上下文*

授权决策使用 Cedar 策略制定，该策略检查来自[用户身份信任提供者](https://docs.aws.amazon.com/verified-access/latest/ug/user-trust.html)（如 Microsoft Entra ID）的用户声明，以及从[基于设备的信任提供者](https://docs.aws.amazon.com/verified-access/latest/ug/device-trust.html)接收的信号。代码片段 3 中的示例授权策略演示了 ID 令牌声明的使用。该策略允许属于特定安全组的用户。
    
    
    permit (principal, action, resource)
    when
    {
        // 检查 ID 令牌中的 groups 声明
        context.my_policy_reference
            .additional_user_context
            .groups
            .contains
            (
                // eng-group
                "221157e3-07c3-4eb0-b62f-bae3b0c3a19b"
            )
    };

*代码片段 3: 检查 ID 令牌声明的示例 Cedar 策略*

通过提供这样的细粒度策略定义，AWS Verified Access 为组织提供强大的工具来实施复杂的访问管理策略。

## 结论

AWS Verified Access 现在在授权过程中支持检查 ID 令牌声明。这提高了与像 Microsoft Entra ID 这样直接在 ID 令牌中发出用户声明的身份提供者的互操作性。管理员现在可以利用这些声明为 HTTP 和非 HTTP 资源创建精确的、基于上下文的访问策略。要开始使用这些增强的授权功能，请访问 [AWS Verified Access 教程](https://docs.aws.amazon.com/verified-access/latest/ug/getting-started.html)。

## 作者介绍

![Ken Kitts](https://d2908q01vomqb2.cloudfront.net/5b384ce32d8cdef02bc3a139d4cac0a22bb029e8/2023/09/12/kenkitts.jpg)

### Ken Kitts

Ken Kitts 是 Amazon Web Services (AWS) 的技术账户经理，拥有超过 20 年的计算机网络专业经验。在当前角色之前，他曾在金融技术领域从事软件定义网络的工作。除了职业成就外，Ken 还是一个狂热的旅行者，对考古学深感兴趣。他经常在旅行中探索当地博物馆和考古遗址，其中墨西哥的 Teotihuacan 对他来说特别有吸引力。

<!-- AI_TASK_END: AI全文翻译 -->

