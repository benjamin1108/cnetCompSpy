# Introducing Layer 7 Network Policies with Advanced Container Networking Services for AKS Clusters!

**原始链接:** [https://techcommunity.microsoft.com/blog/azurenetworkingblog/introducing-layer-7-network-policies-with-advanced-container-networking-services/4409782](https://techcommunity.microsoft.com/blog/azurenetworkingblog/introducing-layer-7-network-policies-with-advanced-container-networking-services/4409782)

**发布时间:** 2025-04-30

**厂商:** AZURE

**类型:** TECH-BLOG

---
Azure Networking Blog 

# Introducing Layer 7 Network Policies with Advanced Container Networking Services for AKS Clusters!

Apr 30, 2025

We have been on an exciting journey to enhance the network observability and security capabilities of Azure Kubernetes Service (AKS) clusters through our [Azure Container Networking Services ](<https://aka.ms/acns>)offering. Our initial step, the launch of [Fully Qualified Domain Name (FQDN) filtering](<https://aka.ms/acns/fqdn>), marked a foundational step in enabling policy-driven egress control. By allowing traffic management at the domain level, we set the stage for more advanced and fine-grained security capabilities that align with modern, distributed workloads. This was just the beginning, a glimpse into our commitment to enabling AKS users with robust and granular security controls.

Today, we are thrilled to announce the public preview of Layer 7 (L7) Network Policies for AKS and Azure CNI powered by Cilium users with Advanced Container Networking Services enabled. This update brings a whole new dimension of security to your containerized environments, offering much more granular control over your application layer traffic.

## Overview of L7 Policy

Unlike traditional Layer 3 and Layer 4 policies that operate at the network and transport layers, L7 policies operate at the application layer. This enables more precise and effective traffic management based on application-specific attributes. L7 policies enable you to define security rules based on application-layer protocols such as HTTP(S), gRPC, and Kafka. For example, you can create policies that allow traffic based on HTTP(S) methods (GET, POST, etc.), headers, paths, and other protocol-specific attributes. This level of control helps in implementing fine-grained access control, restricting traffic based on the actual content of the communication, and gaining deeper insights into your network traffic at the application layer.

## Use cases of L7 policy

**API Security:** For applications exposing APIs, L7 policies provide fine-grained control over API access. You can define policies that only allow specific HTTP(S) methods (e.g., GET for read-only operations, POST for creating resources) on particular API paths. This helps in enforcing API security best practices and prevent unnecessary access.

**Zero-Trust Implementation:** L7 policies are a key component in implementing a Zero-Trust security model within your AKS environment. By default-denying all traffic and then explicitly allowing only necessary communication based on application-layer context, you can significantly reduce the attack surface and improve overall security posture.

**Microservice Segmentation and Isolation:** In microservice architecture, it's essential to isolate services to limit the blast radius of potential security breaches. L7 policies allow you to define precise rules for inter-service communication. For example, you can ensure that a billing service can only be accessed by an order processing service via specific API endpoints and HTTP(S) methods, preventing unauthorized access from other services.

## How Does It Work?

When a pod sends out network traffic, it is first checked against your defined rules using a small, efficient program called an extended Berkley Packet Filter (eBPF) probe. This probe marks the traffic if L7 policies are enabled for that pod, it is then redirected to a local Envoy Proxy. The Envoy proxy here is part of the ACNS Security Agent, separate from the Cilium agent.

The Envoy Proxy, part of the ACNS Security Agent, then acts as a gatekeeper, deciding whether the traffic is allowed to proceed based on your policy criteria. If the traffic is permitted, it flows to its destination. If not, the application receives an error message saying access denied.

![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDA5NzgyLXZuN3JXOA?image-dimensions=750x750&revision=5)

## Example: Restricting HTTP POST Requests

Let's say you have a web application running on your AKS cluster, and you want to ensure that a specific backend service (backend-app) only accepts GET requests on the /data path from your frontend application (frontend-app). With L7 Network Policies, you can define a policy like this:
    
    
    apiVersion: cilium.io/v2
    kind: CiliumNetworkPolicy
    metadata:
      name: allow-get-products
    spec:
      endpointSelector:
        matchLabels:
          app: backend-app # Replace with your backend app name
      ingress:
      - fromEndpoints:
        - matchLabels:
            app: frontend-app # Replace with your frontend app name
        toPorts:
        - ports:
          - port: "80”
            protocol: TCP
          rules:
            http:
            - method: "GET"
              path: "/data"

## How Can You Observe L7 Traffic?

Advanced Container Networking Services with L7 policies also provides observability into L7 traffic, including HTTP(S), gRPC, and Kafka, through Hubble. Hubble is enabled by default with Advanced Container Networking Services. To facilitate easy analysis, Advanced Container Networking Services with L7 policy offers pre-configured Azure Managed Grafana dashboards, located in the **Dashboards > Azure Managed Prometheus folder**. These dashboards, such as **"Kubernetes/Networking/L7 (Namespace)"** and **"Kubernetes/Networking/L7 (Workload)"** , provide granular visibility into L7 flow data at the cluster, namespace, and workload levels.

The screenshot below shows a Grafana dashboard visualizing incoming HTTP traffic for the _http-server-866b29bc75_ workload in AKS over the last 5 minutes. It displays request rates, policy verdicts (forwarded/dropped), method/status breakdown, and dropped flow rates for real-time monitoring and troubleshooting. This is just an example; similar detailed metrics and visualizations, including heatmaps, are also available for gRPC and Kafka traffic on our pre-created dashboards.

![](https://techcommunity.microsoft.com/t5/s/gxcuf89792/images/bS00NDA5NzgyLUxTT2dDbQ?image-dimensions=750x750&revision=5)

For real-time log analysis, you can also leverage the Hubble CLI and UI options offered as part of the Advanced Container Networking Services observability solution, allowing you to inspect individual L7 flows and troubleshoot any policy enforcement.

## Call to Action

We encourage you to try out the public preview of L7 Network Policies on your AKS clusters and level up your network security controls for containerized workloads. We value your feedback as we continue to develop and improve this feature. Please refer to the [Layer 7 Policy Overview](<https://aka.ms/acns/l7policy>) for more information and visit [How to Apply L7 Policy](<https://aka.ms/acns/l7policy-how-to>) for an example scenario.

Updated Apr 30, 2025

Version 2.0